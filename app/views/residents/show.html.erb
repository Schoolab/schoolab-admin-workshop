<div class="row">
  <div class="col-xs-12 col-md-4">
    <div class="panel txt-c">
      <div class="panel-heading">
        <% if @user.photo.file? %>
          <div class="thumbnail ovale-thumb resident-thumb mb" style="width:96px;height:96px;">
            <%= image_tag @user.photo.url(:medium), size: 96 %>
          </div>
        <% else %>
          <div class="thumbnail ovale-thumb no-thumb resident-thumb mb" style="width:96px;height:96px;"></div>
        <% end %>
        <h2><%= @user.name %></h2>
      </div>
      <div class="panel-body">
        <p class="muted">
          <% if @user.title.present? %>
            <%= @user.title %>
          <% end %>
          <% if @user.company.present? %>
            chez <%= link_to @user.company.name, company_path(@user.company) %>
          <% end %>
        </p>
        <ul class="simple-list">
          <li class="list-icon list-icon-email"><%= mail_to @user.email %></li>
          <% if @user.phone? %>
            <li class="list-icon list-icon-phone"><%= tel_to @user.phone %></li>
          <% end %>
        </ul>

        <% if current_user == @user %>
          <%= link_to edit_user_registration_path, class: 'btn btn-default btn-icon' do %>
            <i class="material-icons">settings</i> <span>Paramètres</span>
          <% end %>
        <% elsif current_user.role == "admin" %>
          <ul class="simple-list">
            <% unless @user.last_sign_in_at.present? %>
              <li>L'utilisateur ne s'est jamais connecté.</li>
            <% else @user.current_sign_in_at.present? %>
              <li><%= 'Dernière connexion il y a ' + time_ago_in_words(@user.current_sign_in_at) + '.'%></li>
            <% end %>
          </ul>
          <%= link_to edit_resident_path(@user), class: 'btn btn-default btn-icon' do %>
            <i class="material-icons">settings</i> <span>Paramètres</span>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>

  <div class="col-xs-12 col-md-8">
    <% if (current_user.role == "admin" || current_user == @user ) && @user.reservations.count > 0 %>

    <div class="panel">
      <div class="panel-heading">
        <h2>Dernières réservations</h2>
      </div>

      <div class="panel-body reservation-list">
        <% @user.reservations.order('reservations.start_time DESC').each do |reservation| %>

          <%= render('reservations/reservation-item', reservation: reservation) %>

        <% end %>
      </div>

    </div>

    <% elsif (current_user.role == "admin" || current_user == @user) && @user.reservations.count == 0 %>

      <div class="panel">
      <div class="panel-heading">
        <h2>Dernières réservations</h2>
      </div>
      <div class="panel-body muted">
        Il n'y a aucune réservation récente.
      </div>
    </div>

    <% else %>

    <div class="panel">
      <div class="panel-heading">
        <h2>Dernières réservations</h2>
      </div>
      <div class="panel-body muted">
        Vous n'avez pas accès à la liste des réservations de ce résident.
      </div>
    </div>

    <% end %>
  </div>
</div>
